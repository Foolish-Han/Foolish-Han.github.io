<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Foolish-Han"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://foolish-han.github.io/2025/03/28/oo/buaa oo unit 2/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><link rel="icon" type="image/png" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"><meta name="theme-color" content="#00c1d9"><link rel="shortcut icon" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"><title>电梯调度 | 人月神话</title><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/build/tailwind.css"><link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="/fonts/Geist/geist.css"><link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Farsan&display=swap" rel="stylesheet"><script id="hexo-configurations">window.config={hostname:"foolish-han.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!0,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!0,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"atom-one-light",dark:"monokai-sublime"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:6,number:!0,expand:!0,init_open:!0},copyright:{enable:!1,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!0,recommendation:{enable:!0,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#00c1d9",secondary:null,default_mode:"dark"},global:{fonts:{chinese:{enable:!0,family:"Noto Sans SC",url:"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},english:{enable:!0,family:"Farsan",url:"https://fonts.googleapis.com/css2?family=Farsan&display=swap"},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!1,custom_message:null},open_graph:{enable:!1,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"https://foolish-han.oss-cn-beijing.aliyuncs.com/img0/wallhaven-exk2g8.jpg",dark:"https://foolish-han.oss-cn-beijing.aliyuncs.com/img/%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E5%89%8D%E5%BE%80%E6%9C%88%E7%90%83.png"},title:"人月神话",subtitle:{text:["万里归来颜愈少。微笑，笑时犹带岭梅香。","我见青山多妩媚，料青山见我应如是。","小舟从此逝，江海寄余生。","回首向来萧瑟处，归去，也无风雨也无晴。","醉后不知天在水，满船清梦压星河。"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#2a272a",dark:"#b1bdc5"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!0,family:"Ma Shan Zheng",url:"https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap"},social_links:{enable:"enable",style:"default",links:{github:"https://github.com/Foolish-Han",instagram:null,zhihu:null,twitter:null,email:null},qrs:null}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.2",navbar:{auto_hide:!0,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"},Friends:{icon:"fa-solid fa-link",path:"/links/"},Github:{path:"https://github.com/Foolish-Han",icon:"fa-brands fa-github"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:"究天人之际，通古今之变",show_on_mobile:!0,links:null,Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2025/1/1 00:00:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><link rel="stylesheet" href="/fontawesome/sharp-solid.min.css"><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/"><img src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg" class="w-full h-full rounded-sm"> </a><a class="logo-title" href="/">人月神话</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive fa-fw"></i> 归档</a></li><li class="navbar-item"><a href="/tags"><i class="fa-regular fa-tags fa-fw"></i> 标签</a></li><li class="navbar-item"><a href="/categories"><i class="fa-regular fa-folder fa-fw"></i> 分类</a></li><li class="navbar-item"><a href="/links/"><i class="fa-solid fa-link fa-fw"></i> 友情链接</a></li><li class="navbar-item"><a target="_blank" rel="noopener" href="https://github.com/Foolish-Han"><i class="fa-brands fa-github fa-fw"></i> GITHUB</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>归档 </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags"><span>标签 </span><i class="fa-regular fa-tags fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories"><span>分类 </span><i class="fa-regular fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/links/"><span>友情链接 </span><i class="fa-solid fa-link fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" target="_blank" rel="noopener" href="https://github.com/Foolish-Han"><span>GITHUB </span><i class="fa-brands fa-github fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">26</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">6</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">21</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">电梯调度</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Foolish-Han</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2025-03-28 23:07:28</span> <span class="mobile">2025-03-28 23:07:28</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-03-28 23:07:28</span> <span class="mobile">2025-03-28 23:07:28</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/OO/">OO</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/">生产者消费者模型</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>5.7k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>20 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h1>BUAA 2024 OO Unit 2</h1><h2 id="Unit-2-概览">Unit 2 概览</h2><p>第二单元的核心内容是 <strong>多线程程序设计</strong>，以 <strong>电梯调度</strong><br>问题为核心任务。即给定具有特定参数（容量、开关门时间、运行速度等）的六部电梯，不定时输入乘客（纸片人，被动接受电梯调度）请求和电梯重置请求（修改参数，单轿厢变双轿厢），要求在规定时间内将乘客正确送达，并通过输出时间戳的方式检验调度是否合乎逻辑。</p><p><a class="link" target="_blank" rel="noopener" href="https://easylink.cc/7frzku">指导书自取<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><h2 id="Hw-5">Hw 5</h2><p>第一次作业中，乘客的请求指定了电梯，需要着重处理的是电梯调度的 <strong>架构设计</strong> 和 <strong>运行策略</strong> 问题。</p><h3 id="架构设计">架构设计</h3><p>整体采用了生产者——消费者模型，具体到电梯调度问题，即采用了 “1+1+6” 的设计模式。</p><h4 id="生产者——消费者模型">生产者——消费者模型</h4><p><code>InputThread</code>：一个输入线程（生产者）。因为输入是不定时的，所以我们需要一个线程来专门处理输入。这个线程从控制台中获取输入，并通过调用官方包将其封装为<br><code>Request</code> 请求。同时，将请求放入 <code>requestQueue</code> 中。</p><p><code>Scheduler</code>：一个调度器线程。当 <code>requestQueue</code> （相当于盘子）中有请求时，将其取出，并按照一定的策略分配，放入相应电梯的候乘表<br><code>waitRequests</code> 中，交给电梯线程处理。因为第一次作业指明了乘客乘坐的电梯，所以 <strong>调度策略</strong> 实际上被简化为<br><strong>按照电梯的 ID 进行分配</strong>。</p><p><code>ElevatorThread</code>：六个电梯线程（消费者）。当 <code>waitRequests</code> 中有请求时，按照一定的运行逻辑，依次处理乘客请求，并输出<br>open、close、in、out、arrive 等信息。</p><h4 id="共享对象问题">共享对象问题</h4><p>在确定了整体框架之后，我们可以看到其中的两个 <strong>共享对象</strong><br>需要我们格外注意，通过一定的同步控制手段来避免写后读、写后写等可能带来的访问次序混乱造成的问题。</p><p><code>requestQueue</code>：对于请求队列，由于内置的 <code>Queue</code> 的线程安全得不到保障，所以我对其进行封装，自己实现了一个线程安全类<br><code>RequestQueue</code>（当然也可以使用 <code>BlockingQueue</code> 这种内置的线程安全类，但是用了这单元就没什么好玩的了……）。这个类本身具有一个<br><code>Queue&lt;PersonRequest&gt;</code> 队列，通过对添加、取出元素的方法使用 <code>synchronized</code><br>修饰，来保证线程安全。之所以采取这样的设计，是为了让输入线程和调度器线程关注于自身的业务逻辑，而无需考虑线程安全问题。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestQueue</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;PersonRequest&gt; requests;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addRequest</span><span class="params">(PersonRequest request)</span> {</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> PersonRequest <span class="title function_">getRequest</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><p>这里的 <strong>锁</strong> 实际上是 <code>requestQueue</code> 本身，同步块中的语句操作的也是这个对象的属性，是使用共享对象本身作为锁。</p><p><code>waitRequests</code>：对于候乘表，我们实际上也可以实现一个线程安全类或者直接把 <code>RequestQueue</code><br>拿来用，添加调度器线程和电梯线程可能需要调用的方法即可。但遗憾地是，我一开始并没有意识到这个问题，而是直接使用了一个<br><code>HashMap&lt;Integer,Queue&lt;PersonRequest&gt;&gt;</code> 类型的属性，这就导致我每每在使用 <code>waitRequests</code> 时都得使用<br><code>synchronized</code> 来控制，难免出现遗漏同步造成的 bug 或者过度同步造成并发性能下降的问题。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">notHasRequests</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.lock) {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.elevator.getNumIn() == <span class="number">0</span> &amp;&amp; <span class="built_in">this</span>.numOut == <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPersonRequest</span><span class="params">(PersonRequest personRequest)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">fromFloor</span> <span class="operator">=</span> personRequest.getFromFloor();</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.lock) {</span><br><span class="line">        Queue&lt;PersonRequest&gt; requestQueue = <span class="built_in">this</span>.waitRequests.get(fromFloor);</span><br><span class="line">        requestQueue.offer(personRequest);</span><br><span class="line">        <span class="built_in">this</span>.receive(personRequest);</span><br><span class="line">        <span class="built_in">this</span>.numOut++;</span><br><span class="line">        <span class="built_in">this</span>.lock.notifyAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></div><p>这里的 <strong>锁</strong> 并没有使用共享对象 <code>waitRequests</code> 本身，而是在 <code>ElevatorThread</code><br>中新建了一个对象作为锁。这样做是因为部分需要同步控制的语句并不直接操作 <code>waitRequests</code>，但却间接与其相关。比如上面的<br><code>this.numOut</code> 是在操作 <code>waitRequests</code> 时可能改变的值，算是其 <strong>附属共享对象</strong>，故而新建了 <code>this.lock</code><br>作为调度器线程与输入线程交互时使用的控制锁。</p><h3 id="运行策略">运行策略</h3><p>所谓运行策略，即一部电梯在已知其要接送乘客请求的情况下，选择如何接送乘客的问题。这个策略的选择将很大程度上影响我们的性能分，需要我们综合考虑<br><strong>电梯耗电量</strong>（电梯上下楼、开关门次数）、 <strong>系统运行时间</strong> （处理完所有请求所需的时间）、 <strong>乘客等待时间</strong><br>等因素。</p><h4 id="策略类">策略类</h4><p>按照课程组推荐的写法（也是非常好的一种做法），我们应该把电梯运行的策略抽象出来作为一个类，能够根据电梯运行的各个参数给出运行的建议（开门，关门，移动），从而指挥电梯进行运行。这样做的好处在于<br><strong>电梯的运行与策略分离</strong> ，能够随时根据需要改变电梯的运行策略，具有很好的可扩展性。这样做电梯线程本身其实相当于一个<br><strong>有限状态机</strong> ，由策略类指挥电梯线程完成状态转移。</p><p>由于我一开始认为策略类读取电梯的各种状态十分麻烦，所以便没有写策略类，而是直接糅合到电梯线程本身。导致电梯线程耦合了很多本不属于<br><strong>电梯运行</strong> 这个业务逻辑的东西，给后续扩展、debug 带来了不小的负担，应该引以为戒！</p><h4 id="我的策略">我的策略</h4><p>尽管性能要求的点很多，但归根到我们的设计上，就是要使电梯 <strong>在一次运行的过程中尽可能载入更多乘客</strong><br>，以此提高电梯的吞吐量。因为我们无法预判接下来的输出会是什么情形，所以也就不存在所谓的最优策略。我们应该尽可能地做好<br><strong>trade-off</strong>，使得运行策略能够适应于大多数情况。在这个问题上，我相信 <strong>存在即合理</strong><br>，现实中电梯的运行方式一定是作出大量权衡的结果，于是选择了接近于现实的 <strong>Look</strong> 策略。即：</p><ol><li>电梯启动时，向最先发出请求的乘客所在的位置进行移动；</li><li>电梯到达某一层时，若内部有乘客在这一层出去，则开门放客；若外部乘客的请求方向与电梯运行方向一致，则开门接客；</li><li>当电梯运行方向上不再有内部请求（在接下来的某一层出去）和外部请求（在接下来的某一层进来）时，则更改方向。</li></ol><p>一言以蔽之，电梯应当尽可能地朝着当前方向移动， <strong>尽可能地捎带乘客</strong> ，直到该方向上没有请求再更改方向。</p><h4 id="电梯线程与电梯类">电梯线程与电梯类</h4><p>在这次作业中，我分别实现了 <code>ElevatorThread</code> 和 <code>Elevator</code><br>两个类。前者关注过程，负责电梯运行的逻辑；后者关注状态，存储电梯的各种信息。这样做看起来有点多此一举，但实际上有利于我们在进行多线程设计时，把注意力集中到<br><code>ElevatorThread</code> 和其他线程的交互上而不必被其他不存在多线程情况的因素所干扰（<s>实际上是怕一个类的长度超过<br>checkstyle 的限制</s>）。<code>Elevator</code> 中存放了电梯的参数和各种状态量，并配备了 <code>get</code> 和 <code>set</code> 方法供<br><code>ElevatorThread</code> 使用，同时所有的输出也通过后者调用前者的方法来实现。这种实现使得 <code>Elevator</code><br>看起来像电梯本身，而 <code>ElevatorThread</code> 像电梯外的请求（<s>实际上变相实现了一个策略类</s>）。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 电梯 ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> id;</span><br><span class="line"><span class="comment">// 电梯容量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"><span class="comment">// 电梯所能到达的最高楼层</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">maxFloor</span> <span class="operator">=</span> <span class="number">11</span>;</span><br><span class="line"><span class="comment">// 电梯所能到达的最低楼层</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">minFloor</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 电梯移动一层所需的时间(ms)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">moveTime</span> <span class="operator">=</span> <span class="number">400</span>;</span><br><span class="line"><span class="comment">// 电梯开门所需的时间(ms)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">openTime</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="comment">// 电梯关门所需的时间(ms)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">closeTime</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="comment">// 正在电梯内的人(目的楼层到请求的映射)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;Integer,Queue&lt;PersonRequest&gt;&gt; runRequests = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 电梯内的总人数</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> numOfIn;</span><br><span class="line"><span class="comment">// 电梯当前所在楼层</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> curFloor;</span><br><span class="line"><span class="comment">// 电梯运行方向(默认为下)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> down;</span><br><span class="line"><span class="comment">// 电梯是否在运动</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> isRunning;</span><br></pre></td></tr></table></figure></div><h4 id="量子电梯">量子电梯</h4><p>在本单元的作业中，主要通过输出时间戳的方式模拟电梯运行所需的时间。这意味我们的电梯并不用真的花费 0.4s<br>去移动一层楼，只需保证在合适的有输出即可，这使得我们可以 **在忽略电梯移动所需时间的基础上去优化我们的运行策略<br>** 。当电梯需要移动一层楼时，我们不必老老实实地等 0.4s 去移动。当这 0.4s<br>内有新的请求且可以捎带时，我们就可以重新开门让新来的乘客进入；倘若没有可以捎带的请求时，我们等时间到了让电梯瞬移即可，以此来优化局部的吞吐量。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">arrive</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">while</span> (System.currentTimeMillis() - start &lt; <span class="built_in">this</span>.elevator.getMoveTime()) {</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>.lock) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="built_in">this</span>.lock.wait(<span class="built_in">this</span>.elevator.getMoveTime());</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.isOpen()) {</span><br><span class="line">            <span class="built_in">this</span>.doWhileOpen();</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.elevator.getIsRunning()) {</span><br><span class="line">        <span class="built_in">this</span>.elevator.arrive();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><h2 id="Hw6">Hw6</h2><p>第二次作业不再为乘客指定电梯，同时新增了 <code>reset</code> 请求，需要着重考虑电梯的 <strong>分配策略</strong> 和 **<br>重置请求的处理 **。</p><h3 id="分配策略">分配策略</h3><p>同运行策略一样，我们在考虑分配策略时也要着眼于 <strong>电梯耗电量</strong>（电梯上下楼、开关门次数）、 **系统运行时间<br>** （处理完所有请求所需的时间）、 <strong>乘客等待时间</strong><br>等因素。同样的，由于我们无法预判未来时间的输入，绝对最优的策略也不存在，我们所能做的只是尽可能地现有条件下最适合当前乘客请求的电梯。</p><h4 id="随机分配">随机分配</h4><p>随机分配可以说是 <strong>一本万利</strong> 的策略。在仅有六部电梯的情况下，我们所随机分配的电梯有高达 <code>16.6%</code><br>的概率是最优解，而且是从未来的全知视角下考虑的最优解。尽管这有些冒险，但在面对各种类型的数据点时，就会表现出高度的稳定性。虽然不一定是最优解，但一定不是最差解。同时，因为随机分配往往比较均匀，所以我们也能保持高程度的<br><strong>负载均衡</strong>。最主要的是，这种策略只需要一行代码就能实现。</p><p>为了提高随机分配策略的下限，我本人采取了 <strong>有选择性的随机分配</strong><br>策略。即先把所有电梯作为初始集合，然后选出满足某一条件的电梯子集，倘若子集不存在，则在该原集合中进行随机分配；不然，则在子集中进一步优选。这样做的可行性在于，我们总可以确定满足某一条件的电梯是更好的选择，比如空位较多、速度较快、运行方向与请求顺路等等。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispatchRequest</span><span class="params">(PersonRequest request)</span> {</span><br><span class="line">    ArrayList&lt;ElevatorThread&gt; judge = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (ElevatorThread elevatorThread : elevatorThreads) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="comment">/* some conditions */</span>) {</span><br><span class="line">            judge.add(elevatorThread);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (judge.isEmpty()) {</span><br><span class="line">        <span class="built_in">this</span>.elevatorThreads[random.nextInt(<span class="number">6</span>)].addRequest(request);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    ArrayList&lt;ElevatorThread&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (ElevatorThread elevatorThread : judge) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="comment">/* some conditions */</span>) {</span><br><span class="line">            temp.add(elevatorThread);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (temp.isEmpty()) {</span><br><span class="line">        judge.get(random.nextInt(judge.size())).addRequest(request);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// so on...</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><h4 id="调参大法">调参大法</h4><p>这种方法意在建立一套标准去衡量各个电梯对当前请求的适合程度，然后据此选出最优解。我们要像数学建模一样，去评估电梯的各个参数与当前请求的参数的契合程度。但由于我们无法预知未来输入，甚至完全不知道输入数据可能存在的统计特征，所以这种方法是十分吃力不讨好的，效果很容易比随机分配差得多。</p><h4 id="影子电梯">影子电梯</h4><p>尽管我们无法预知未来，但是我们可以模拟未来。因为我们所有的操作都是在模拟电梯运行，这就意味着可以快速计算出当前乘客分配给某一电梯后完成请求所需的时间。我们只需完整克隆电梯的当前状态（所在楼层、请求队列等），把当前请求分配给电梯，同时将原本<br><code>wait</code>、<code>sleep</code> 掉的时间加起来即可计算出来。<s>更过分一点的话，</s><br>还可以把指导书中计算性能分的公式搬过来，计算当前请求分配给某个电梯的最高性能分，择优调度。可以说，这种贪心策略是我们所能实现的，局部意义上的最优解。毕竟<br><strong>没有什么比让未来“真实”发生一遍更能预知未来了</strong>。但是由于一开始对影子电梯有些误解，并没有意识到其巨大威力，所以很遗憾我没有采取影子电梯策略。</p><h3 id="重置请求的处理">重置请求的处理</h3><p>关于 <code>reset</code> 请求，需要着重考虑的问题是如何在规定时间内完成以及如何重新分配重置电梯已有的请求。</p><h4 id="规定时间内响应">规定时间内响应</h4><p>规定时间内响应有两重具体要求，一是及时把重置请求发送给电梯线程，二是电梯线程要立刻处理重置请求。</p><p>对于前者，我们第一想法可能是把重置请求当作一般请求，放入 <code>requestQueue</code> 中进行处理，但由于队列 **先进先出<br>** 的特征，重置请求的 <strong>优先级</strong><br>并不能得到保证。同时，由于在线程分配中可能存在调度器线程抢不到线权的情况，所以将重置请求插到队首也不是很好的选择。因此，我选择了将重置请求在输入线程中直接分配给电梯线程，并通过同步块加以控制，保证在接收到重置请求输入后立马进行分配。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">ElevatorInput</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElevatorInput</span>(System.in);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) {</span><br><span class="line">            <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> input.nextRequest();</span><br><span class="line">            <span class="keyword">if</span> (request == <span class="literal">null</span>) {</span><br><span class="line">                requestQueue.setEnd(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ResetRequest) {</span><br><span class="line">                    <span class="type">ResetRequest</span> <span class="variable">resetRequest</span> <span class="operator">=</span> (ResetRequest) request;</span><br><span class="line">                    elevatorThread[resetRequest.getElevatorId() - <span class="number">1</span>].addRequest(request);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    requestQueue.addRequest(request);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        input.close();</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><p>对于后者，重置请求到来时有三种情况：</p><ol><li>电梯到达某一层后，将要决定开不开门</li><li>电梯开门后，尚未关门的空档</li><li>电梯准备移动后，但尚未（瞬移）到下一层。</li></ol><p>由于我们采用了量子电梯，电梯在移动前也会判断是否要开门并进行相关操作，所以 <code>reset</code><br>相关的操作便集中在开门条件和开门期间的放客上，我们只需在 <code>boolean isOpen()</code>中修改 reset 相关的开门条件，在<br><code>doWhileOpen()</code> 中增加重置相关操作即可。</p><h4 id="重新分配重置电梯已有的请求">重新分配重置电梯已有的请求</h4><p>对于尚未进入电梯的乘客，将其请求原封不动重新放回 <code>requestQueue</code><br>中；对于从电梯中出来的乘客，若其出来的楼层并非其目的地，再将当前楼层更新为其初始楼层后，再放回<br><code>requestQueue</code> 中。</p><h2 id="Hw7">Hw7</h2><p>第三次作业新增了双轿厢电梯，需要着重考虑 <strong>双轿厢的启动</strong> 和 <strong>双轿厢的协同</strong> 问题。</p><h3 id="双轿厢的启动">双轿厢的启动</h3><p>鉴于双轿厢电梯和原有电梯的 id 相同的关系，我新增了一个 <code>ElevatorController</code> 类来处理单轿厢到双轿厢的切换，原有的对<br><code>ElevatorThread</code> 的操作都间接地通过这个中间层来实现。<code>elevatorThread</code>、<code>carA</code>、<code>carB</code><br>都作为其中的属性，当收到切换双轿厢的请求时，<code>ElevatorController</code> 调用 <code>elevatorThread</code><br>中的方法来退回已有请求，同时结束线程，然后启动 <code>carA</code>、<code>carB</code><br>两个线程，同时管理这两个线程持有同一把锁来保证不相撞。新加中间层的做法也是为了满足开闭原则，保证第一二次作业写的代码都能原封不动的使用（<br><s>主要是怕被改崩了</s>）。</p><h3 id="双轿厢的协同">双轿厢的协同</h3><p>为了保证双轿厢的两个轿厢不碰撞的，我们需要一把锁来保证双轿厢无法同时到达换乘楼层。在这里，我是对<br><code>Boolean</code> 进行包装，新建了一把锁。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BooleanLock</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> bool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getBool</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.bool;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBool</span><span class="params">(<span class="type">boolean</span> bool)</span> {</span><br><span class="line">        <span class="built_in">this</span>.bool = bool;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><p>当电梯即将前往（瞬移到）一个新的楼层时，若其当前楼层和下一楼层为换乘楼层，则对其进行特判，确保其安全地移动，同时修改换乘楼层的占用情况。</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.elevatorCar.getNextFloor() == <span class="built_in">this</span>.transferFloor) {</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.transferFloorLock) {</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.transferFloorLock.getBool()) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="built_in">this</span>.transferFloorLock.wait();</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">this</span>.transferFloorLock.setBool(<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.elevatorCar.arrive();</span><br><span class="line">    }</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.elevatorCar.getCurFloor() == <span class="built_in">this</span>.transferFloor) {</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.transferFloorLock) {</span><br><span class="line">        <span class="built_in">this</span>.transferFloorLock.setBool(<span class="literal">false</span>);</span><br><span class="line">        <span class="built_in">this</span>.elevatorCar.arrive();</span><br><span class="line">        <span class="built_in">this</span>.transferFloorLock.notifyAll();</span><br><span class="line">    }</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">this</span>.elevatorCar.arrive();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><h2 id="架构模式">架构模式</h2><h3 id="类分析">类分析</h3><p></p><figure class="image-caption"><img lazyload="" src="/images/loading.svg" data-src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/ClassDiagram-0-1713543651737-2.png" alt="核心类"><figcaption>核心类</figcaption></figure><p></p><p>从类的设计上来看，三次作业采用了统一的框架。第二次作业在 <code>ElevatorThread</code> 中新增了 reset 相关的方法，在<br><code>Scheduler</code> 新增了调度策略，在 <code>InputThread</code> 中新增了 <code>Reset</code> 请求的直接分配。第三次作业在前两次作业的基础上新增了<br><code>ElevatorController</code> 这一中间层，并修改了相应的方法。</p><h3 id="线程分析">线程分析</h3><p></p><figure class="image-caption"><img lazyload="" src="/images/loading.svg" data-src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/SequenceDiagram-0.png" alt="UML 时序图"><figcaption>UML 时序图</figcaption></figure><p></p><p>从线程的协作关系上看，四类线程贯彻三次作业的全过程，并通过 <code>RequestQueue</code> 和 <code>BooleanLock</code><br>两个共享对象类来互相协调，通过 <code>ElevatorController</code> 类来进行管理。</p><ol><li><code>Main</code> 线程主要负责启动其他线程，做好初始化工作</li><li><code>InputThread</code> 线程主要负责从标准输入流接收输入，并按需解析、转化为各种请求对象</li><li><code>Scheduler</code> 线程主要负责对请求对象进行分配调度，交由电梯线程进行处理</li><li><code>ElevatorThread</code> 线程是电梯业务的核心类，按照一定的运行策略处理调度器分配的请求，产生输出</li></ol><h2 id="bug-分析">bug 分析</h2><h3 id="我的bug">我的bug</h3><p>（<s>由于本单元采取了谨慎的优化方式，</s>）三次作业在强测中并未发现<br>bug，不过在最后一次作业的互测中被砍了一刀。主要问题在于判断结束的条件设置不够完备，导致在少数极端数据下（全部在同一时间发出乘客请求，同时对六部电梯进行单轿厢到双轿厢的转换操作），有概率爆出请求尚未处理但程序已经结束的情况。</p><p>在判断是否结束上，我原本采取的策略是同时满足以下条件，则认为可以结束：</p><ol><li>输入结束</li><li>每个电梯线程的请求均已处理完毕（内外都没人）</li><li>没有电梯正在重置</li></ol><p>我的问题出在第三点上。我在接收到重置请求后，会把 <code>ElevatorController</code> 的 <code>isDoubleCar</code><br>标志置位，不管双轿厢有没有切换完毕，随后的请求添加、状态读取都不再分配给原来的单轿厢，而是分配给新的双轿厢。因为双轿厢电梯不会接受重置请求，所以双轿厢电梯的<br><code>getIsReset()</code> 方法我会直接返回 <code>false</code><br>。这样就会导致一种极端情况，所有单轿厢都完成切换到双轿厢的重置工作，但是那些被返工的请求尚未分配给新的双轿厢电梯，导致上述三个条件被意外满足，造成提前结束的问题。</p><p>因此，debug 的方式也很简单，将双轿厢电梯 <code>getIsReset()</code> 的返回值设置为双轿厢是否切换完毕的标准即可。</p><p>当然，我这种采取判断电梯状态的方法其实很容易丢三落四、不方便扩展。更好的判断结束的条件是采用一个 **计数器<br>** 去计数，当接收到新的请求时加一，当乘客到达目的地或者重置完成时时减一。当计数器为零且输入完成时，即可结束。这种方法无疑是抓住了本质，不需关注繁杂的条件和共享对象的使用，可扩展性良好。</p><h3 id="Debug-方式">Debug 方式</h3><p>对于多线程编程来说， <strong>比解决问题更难的是发现问题</strong>。由于线程调度的随机性，我们程序的输出并没有确定性的结果，即使知道有<br>bug 也很难复现出来，即使复现出来在调试模式下可能又是另一副样子。对此，我们别无选择，只有经过大量的测试才有可能发现程序的<br>bug。</p><p>更多的时候，我们能做的其实是对整个程序进行复盘，找到不同线程交互的地方，然后发动脑筋去想想有没有可能存在问题。因为我们在设计的时候，其实存在着一种思维偏差，我们会默认某些方法按照我们预想的顺序执行，就比如我上面的<br>bug 就是默认重置完了总会第一时间去重新分配请求。所以，假想线程按照一种几乎不可能的极端的顺序执行，可能是一条发现<br>bug 的出路。</p><p>总体而言，还是需要我们理解并发的思想，掌握同步互斥的方法，才能实现无懈可击的多线程设计。</p><h2 id="心得体会">心得体会</h2><h3 id="线程安全">线程安全</h3><p>在线程问题上，我们应当明确划分每个线程的职责。只有 <code>Run</code><br>方法是线程的执行流，每个线程的执行流都是各司其职、互不干涉。当我们调用一个线程对象的方法时，并不意味着是这个线程在执行，而很有可能是别的线程在试图获取这个线程的某些状态、修改这个线程的某些参数，我们应该对这些方法进行严格的审视以考虑同步控制的使用。</p><h3 id="层次化设计">层次化设计</h3><p>在层次结构上，多线程设计最主要的是明确调用关系，明确生命周期，洞悉线程之间一对一、一对多、多对多的协作关系，做好设计。</p></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/">#生产者消费者模型</a>&nbsp;</li></ul><div class="recommended-article px-2 sm:px-6 md:px-8"><div class="recommended-desktop"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO 2024 Unit 4 & Final/" title="图书管理" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="图书管理" class="!max-w-none"> <span class="title">图书管理</span> </a><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO Unit 3/" title="社交网络" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="社交网络" class="!max-w-none"> <span class="title">社交网络</span> </a><a class="recommended-article-item" href="/2025/03/28/OO/BUAA 2024 OO Unit1/" title="数学表达式计算" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="数学表达式计算" class="!max-w-none"> <span class="title">数学表达式计算</span></a></div></div><div class="recommended-mobile"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO 2024 Unit 4 & Final/" title="图书管理" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="图书管理" class="!max-w-none"> <span class="title">图书管理</span> </a><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO Unit 3/" title="社交网络" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="社交网络" class="!max-w-none"> <span class="title">社交网络</span></a></div></div></div><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2025/03/28/OO/BUAA%20OO%20Unit%203/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">社交网络</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2025/03/28/OS/Lab1%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">OS-Lab1</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">电梯调度</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">BUAA 2024 OO Unit 2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Unit-2-%E6%A6%82%E8%A7%88"><span class="nav-number">1.1.</span> <span class="nav-text">Unit 2 概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw-5"><span class="nav-number">1.2.</span> <span class="nav-text">Hw 5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.2.1.</span> <span class="nav-text">架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E2%80%94%E2%80%94%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">生产者——消费者模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">共享对象问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%AD%96%E7%95%A5"><span class="nav-number">1.2.2.</span> <span class="nav-text">运行策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E7%B1%BB"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">策略类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%91%E7%9A%84%E7%AD%96%E7%95%A5"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">我的策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E6%A2%AF%E7%BA%BF%E7%A8%8B%E4%B8%8E%E7%94%B5%E6%A2%AF%E7%B1%BB"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">电梯线程与电梯类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8F%E5%AD%90%E7%94%B5%E6%A2%AF"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">量子电梯</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw6"><span class="nav-number">1.3.</span> <span class="nav-text">Hw6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="nav-number">1.3.1.</span> <span class="nav-text">分配策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E5%88%86%E9%85%8D"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">随机分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E5%8F%82%E5%A4%A7%E6%B3%95"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">调参大法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BD%B1%E5%AD%90%E7%94%B5%E6%A2%AF"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">影子电梯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E7%BD%AE%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">1.3.2.</span> <span class="nav-text">重置请求的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E5%AE%9A%E6%97%B6%E9%97%B4%E5%86%85%E5%93%8D%E5%BA%94"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">规定时间内响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%88%86%E9%85%8D%E9%87%8D%E7%BD%AE%E7%94%B5%E6%A2%AF%E5%B7%B2%E6%9C%89%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">重新分配重置电梯已有的请求</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw7"><span class="nav-number">1.4.</span> <span class="nav-text">Hw7</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E8%BD%BF%E5%8E%A2%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="nav-number">1.4.1.</span> <span class="nav-text">双轿厢的启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E8%BD%BF%E5%8E%A2%E7%9A%84%E5%8D%8F%E5%90%8C"><span class="nav-number">1.4.2.</span> <span class="nav-text">双轿厢的协同</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.5.</span> <span class="nav-text">架构模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%88%86%E6%9E%90"><span class="nav-number">1.5.1.</span> <span class="nav-text">类分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%88%86%E6%9E%90"><span class="nav-number">1.5.2.</span> <span class="nav-text">线程分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bug-%E5%88%86%E6%9E%90"><span class="nav-number">1.6.</span> <span class="nav-text">bug 分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%91%E7%9A%84bug"><span class="nav-number">1.6.1.</span> <span class="nav-text">我的bug</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Debug-%E6%96%B9%E5%BC%8F"><span class="nav-number">1.6.2.</span> <span class="nav-text">Debug 方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A"><span class="nav-number">1.7.</span> <span class="nav-text">心得体会</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">1.7.1.</span> <span class="nav-text">线程安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%82%E6%AC%A1%E5%8C%96%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.7.2.</span> <span class="nav-text">层次化设计</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="customize-info my-1">小舟从此逝，江海寄余生。</div><div class="text-center">&copy; <span>2025</span> - 2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Foolish-Han</a><p class="post-count space-x-0.5"><span>共撰写了 21 篇文章 </span><span>共 53.4k 字</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span></div><div class="icp-info my-1"><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">京ICP备2025112106号-1</a></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="站内搜索您需要的内容..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/build/libs/Swup.min.js"></script><script src="/js/build/libs/SwupSlideTheme.min.js"></script><script src="/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="/js/build/libs/SwupProgressPlugin.min.js"></script><script src="/js/build/libs/SwupScrollPlugin.min.js"></script><script src="/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/build/tools/imageViewer.js" type="module"></script><script src="/js/build/utils.js" type="module"></script><script src="/js/build/main.js" type="module"></script><script src="/js/build/layouts/navbarShrink.js" type="module"></script><script src="/js/build/tools/scrollTopBottom.js" type="module"></script><script src="/js/build/tools/lightDarkSwitch.js" type="module"></script><script src="/js/build/layouts/categoryList.js" type="module"></script><script src="/js/build/tools/localSearch.js" type="module"></script><script src="/js/build/tools/codeBlock.js" type="module"></script><script src="/js/build/layouts/lazyload.js" type="module"></script><script src="/js/build/tools/runtime.js"></script><script src="/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/build/libs/Typed.min.js"></script><script src="/js/build/plugins/typed.js" type="module"></script><script src="/js/build/libs/anime.min.js"></script><script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script><script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script><script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script><script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script><script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script><script src="/js/build/libs/pangu.min.js"></script><script src="/js/build/plugins/pangu.js"></script></body></html>