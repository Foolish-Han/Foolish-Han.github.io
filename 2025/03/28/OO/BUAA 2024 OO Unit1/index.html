<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Foolish-Han"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://foolish-han.github.io/2025/03/28/oo/buaa 2024 oo unit1/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><link rel="icon" type="image/png" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"><meta name="theme-color" content="#00c1d9"><link rel="shortcut icon" href="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"><title>数学表达式计算 | 人月神话</title><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/build/tailwind.css"><link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="/fonts/Geist/geist.css"><link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Farsan&display=swap" rel="stylesheet"><script id="hexo-configurations">window.config={hostname:"foolish-han.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!0,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!0,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"atom-one-light",dark:"monokai-sublime"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:6,number:!0,expand:!0,init_open:!0},copyright:{enable:!1,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!0,recommendation:{enable:!0,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#00c1d9",secondary:null,default_mode:"dark"},global:{fonts:{chinese:{enable:!0,family:"Noto Sans SC",url:"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},english:{enable:!0,family:"Farsan",url:"https://fonts.googleapis.com/css2?family=Farsan&display=swap"},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!1,custom_message:null},open_graph:{enable:!1,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"https://foolish-han.oss-cn-beijing.aliyuncs.com/img0/wallhaven-exk2g8.jpg",dark:"https://foolish-han.oss-cn-beijing.aliyuncs.com/img/%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E5%89%8D%E5%BE%80%E6%9C%88%E7%90%83.png"},title:"人月神话",subtitle:{text:["万里归来颜愈少。微笑，笑时犹带岭梅香。","我见青山多妩媚，料青山见我应如是。","小舟从此逝，江海寄余生。","回首向来萧瑟处，归去，也无风雨也无晴。","醉后不知天在水，满船清梦压星河。"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#2a272a",dark:"#b1bdc5"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!0,family:"Ma Shan Zheng",url:"https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap"},social_links:{enable:"enable",style:"default",links:{github:"https://github.com/Foolish-Han",instagram:null,zhihu:null,twitter:null,email:null},qrs:null}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.2",navbar:{auto_hide:!0,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"},Friends:{icon:"fa-solid fa-link",path:"/links/"},Github:{path:"https://github.com/Foolish-Han",icon:"fa-brands fa-github"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:"究天人之际，通古今之变",show_on_mobile:!0,links:null,Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2025/1/1 00:00:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><link rel="stylesheet" href="/fontawesome/sharp-solid.min.css"><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/"><img src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg" class="w-full h-full rounded-sm"> </a><a class="logo-title" href="/">人月神话</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive fa-fw"></i> 归档</a></li><li class="navbar-item"><a href="/tags"><i class="fa-regular fa-tags fa-fw"></i> 标签</a></li><li class="navbar-item"><a href="/categories"><i class="fa-regular fa-folder fa-fw"></i> 分类</a></li><li class="navbar-item"><a href="/links/"><i class="fa-solid fa-link fa-fw"></i> 友情链接</a></li><li class="navbar-item"><a target="_blank" rel="noopener" href="https://github.com/Foolish-Han"><i class="fa-brands fa-github fa-fw"></i> GITHUB</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>归档 </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags"><span>标签 </span><i class="fa-regular fa-tags fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories"><span>分类 </span><i class="fa-regular fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/links/"><span>友情链接 </span><i class="fa-solid fa-link fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" target="_blank" rel="noopener" href="https://github.com/Foolish-Han"><span>GITHUB </span><i class="fa-brands fa-github fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">28</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">6</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">21</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">数学表达式计算</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/01b9dc528c8e555aaa144149fff1a88f_1.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Foolish-Han</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2025-03-28 23:07:28</span> <span class="mobile">2025-03-28 23:07:28</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-03-28 23:07:28</span> <span class="mobile">2025-03-28 23:07:28</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/OO/">OO</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D/">递归下降</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>5.8k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>21 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="Unit1-概览">Unit1 概览</h2><p>Unit1的核心任务是进行<strong>数学表达式的化简</strong>，在保证正确性的前提下以化简后<strong>字符串的长度</strong>作为性能的评价依据。程序设计的目的旨在用自动化的方法把人从<s>丑陋</s>、<s>易错</s>的<strong>多项式展开</strong>、<strong>求导</strong>中解放出来，实现一个简单的数学计算器。</p><h2 id="Hw1-——万丈高楼平地起">Hw1 ——万丈高楼平地起</h2><p>读入一个包含加、减、乘、乘方以及括号（其中括号的深度至多为 1 层）的单变量表达式，输出恒等变形展开所有括号后的表达式。</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input:</span><br><span class="line">--(x^2++1)*(x-1)-(x^+0002-+0001)*(x+1)</span><br><span class="line">output:</span><br><span class="line">2*x-2*x^2 //output</span><br></pre></td></tr></table></figure></div><h3 id="难点分析">难点分析</h3><p>Unit1 的核心问题是<strong>数据结构的设计</strong>，即采取什么样的数据组织方式，可以有效地进行表达式的<strong>解析</strong>、<strong>化简</strong>、<strong>输出</strong>。不论进行怎样的迭代，数学表达式始终在最基本的加减乘除四则运算的框架下，因此最直观的方法就是<strong>根据运算的优先级分层组织</strong>。结合教程给出的示例，便很自然的采取<strong>表达式</strong>、<strong>项</strong>、<strong>因子</strong>三级体系来存储数学表达式。</p><p>表达式是<strong>项</strong>的集合，项之间具有<strong>加减</strong>的关系。<br><br>项是<strong>因子</strong>的集合，因子之间具有<strong>相乘</strong>的关系。<br><br>因子是<strong>最基本的微元</strong>，具有常数因子、变量因子、表达式因子（括号提高了表达式的优先级）等基本类型。</p><h3 id="表达式存储">表达式存储</h3><p><code>Expr</code>类的属性是指数和存放<code>Term</code>的容器。<br><br><code>Term</code>类的属性是存放<code>Factor</code>的容器和项的系数。尽管把不同类型的<code>Factor</code>统一处理，似乎会提出更高的要求，但能够<strong>把复杂度拆分下放</strong>，降低<code>Expr</code>类的负担，避免扩展时拆东墙、补西墙、丢三落四。（但本着<s>屎山最多堆三周</s>的原则，我在<code>Term</code>中将不同类型的<code>Factor</code>分类存储，导致后期维护头重脚轻，相当困难）<br><br>因为因子具有不同的类型（且可能会扩展），因此<code>Factor</code>宜作为一个<strong>接口</strong>来实现，对不同类型的因子分别建类（表达式因子本质上就是表达式加括号，可用<code>Expr</code>类直接替代），实现在<code>Term</code>中需要调用的方法即可。<br></p><blockquote><p>我<s>自作聪明地</s>预判后面会增加多变量的迭代，所以在函数因子中额外增加了变量名称、变量指数的属性，导致后续的求导、同类项合并、函数代入不得不全部实现了多变量的功能，复杂度飙升:cry::cry::cry:</p></blockquote><h3 id="表达式解析">表达式解析</h3><p>在建立了整体的框架后，<strong>递归下降</strong>便是解析表达式的自然选择。<br><br>解析表达式时，<code>parseExpr</code>方法只根据表达式中的<code>+</code> <code>-</code>符号来组织通过<code>parseTerm</code>方法获得的项。<br><br>解析项时，<code>parseTerm</code>方法只根据项中的符号来组织通过<code>parseFactor</code>方法获得的因子。<br><br>解析因子时，<code>parseFactor</code>方法只根据不同类型因子的标识符（括号、变量、常数）来<strong>生成因子</strong>。</p><blockquote><p>我们<strong>通过分层处理，将复杂的问题简化，提高了代码的可读性和可扩展性</strong>。</p></blockquote><h3 id="表达式化简">表达式化简</h3><p>表达式化简的核心在于<strong>多项式相乘</strong>和<strong>同类项合并</strong>，这个部分也是最影响算法时间复杂度的地方。由于喜欢自己摸索（<s>碰壁</s>），没有阅读过任何 OO 相关的博客，所以这个部分采取的是很朴素的<strong>模拟人类计算过程</strong>的方法。</p><p>在<strong>多项式相乘</strong>上，我并没有专门设计一个多项式类来处理，而是通过<code>Expr</code>类中的<code>addTerm</code>方法来实现。我们知道，<code>多项式相乘</code>实际上指的是<code>Term</code>中表达式因子的运算。因为<strong>多项式相乘</strong>的结果是个表达式，所以在解析项的环节，我只是把这些表达式因子存储起来，在把<code>Term</code>添加到<code>Expr</code>的环节中才把它们展开。<br><br>在<code>addTerm</code>方法中，首先建立一个空表达式<code>result</code>，将<code>Term</code>中的非表达式因子整合成项添加到<code>result</code>中。接着再建立一个空表达式<code>temp</code>，同时遍历下一个表达式因子中的每个项与<code>result</code>中的每个项，将二者相乘得到的项添加到<code>temp</code>中。待下一个表达式因子遍历完毕后，将<code>result</code>指向的对象改为<code>temp</code>指向的对象，以此类推即可实现多项式相乘。</p><p>在<strong>同类项合并</strong>方面， Hw1 中只需在<code>Term</code>类中实现判断变量名称及其指数是否相同的方法即可。</p><blockquote><p>需要注意的是，在向<code>temp</code>中添加项时务必同时进行<strong>合并同类项</strong>以降低容器大小，否则就会空间复杂度爆表。若不同时合并同类项时，仅<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.566ex" xmlns="http://www.w3.org/2000/svg" width="8.739ex" height="2.452ex" role="img" focusable="false" viewBox="0 -833.9 3862.6 1083.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1183.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2183.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="msup" transform="translate(2683.4,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(422,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>就能展开出<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewBox="0 -833.9 1290.1 833.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>项，超出堆空间的限度。</p></blockquote><h3 id="表达式输出">表达式输出</h3><p>在三级存储的整体框架下，表达式输出与表达式解析采取同样的思路。<br><br>输出表达式时，<code>Expr</code>的<code>toString</code>方法只根据项之间的关系来组织调整<code>Term</code>的<code>toString</code>方法获得的项字符串。<br><br>输出项时，<code>Term</code>的<code>toString</code>方法只根据项中的因子情况来组织调整<code>Factor</code>的<code>toString</code>方法获得的因子字符串。<br><br>输出因子时，不同类型的因子根据自身的特点，实现相应的<code>toString</code>方法即可。</p><blockquote><p>需要注意的是，我们的<code>toString</code>方法实际上是重写了<code>Object</code>类的<code>toString</code>方法。我们在 idea 的调试中看到的信息，实际上就是调用<code>toString</code>方法的结果。倘若<code>toString</code>方法对表达式、项、因子的内容有所修改（<s>比如排序</s>），可能会造成调试和直接运行结果不一致的现象。</p></blockquote><h3 id="符号处理">符号处理</h3><p>在整个Unit1中，输入的表达式都存在着多重的符号。即表达式中的第一个项前可有<code>+</code> <code>-</code>，项中的第一个因子前可有<code>+</code> <code>-</code>，常数因子自身也可带<code>+</code> <code>-</code>。对这些多余的符号进行正确的处理是我们解析表达式的前提。<br><br>有同学采取了<strong>添加零</strong>的方法来处理，但这会<strong>增加表达式化简的复杂度</strong>；考虑到额外的正负号也是按照层次生成，也有同学采取了<strong>递归下降</strong>的方法来处理，但这也会显著<strong>为后续的层层处理带来麻烦</strong>。我在这块<s>耍了一个小聪明</s>。<br><br>我们注意到，<strong>不论是表达式中的正负号还是因子中的正负号，其最后影响到的都是项的正负</strong>。因此我们可以把正负作为每一项的特性，而不看作项与项之间的关系或者因子的特点。因此，解析表达式时，我们可以记录读取到的<code>-</code>数量，据此判断项的正负需要颠倒，解析因子时亦然。这样就巧妙地规避了额外符号的问题，<s>哪怕输入不当人一直叠加正负号也没问题</s>。</p><h2 id="Hw2-——函数代换伤不起">Hw2 ——函数代换伤不起</h2><p>在 Hw1 的基础上，增加了支持嵌套括号、自定义函数、指数函数的新内容。</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">input:</span><br><span class="line">3</span><br><span class="line">f(x,y,z)=exp(x)+exp(z)</span><br><span class="line">g(y)=y^2</span><br><span class="line">h(z,x)=z*exp(x)</span><br><span class="line">h(f(g(x),(x+1),x^2),exp(x))</span><br><span class="line">output:</span><br><span class="line">2*exp((exp(x)+x^2))</span><br></pre></td></tr></table></figure></div><h3 id="嵌套括号">嵌套括号</h3><p>在Hw1中，我们已经实现了<strong>多项式相乘</strong>，其核心就是<strong>将项中的表达式因子展开</strong>，生成表达式。而嵌套括号的内在意义也就是<strong>表达式因子中含有表达式因子</strong>，这意味这我们处理括号的方式没有改变，仍然是表达式因子的展开，只不过要先展开表达式因子内部的表达式因子。因此，很自然地，我们采取递归的方式处理嵌套括号。<br><br>在 Hw1 <code>addTerm</code>方法的基础上，我们只需对原有的表达式因子进行调整。对于每一个表达式因子，建立一个空的表达式<code>tempExpr</code>，遍历其中的项并递归调用<code>addTerm</code>方法添加到<code>tempExpr</code>中。通过<code>addTerm</code> <strong>表达式因子展开</strong>的功能，我们得到一个<strong>不含表达式因子的表达式因子</strong><code>tempExpr</code>，那么便可以接着采用 Hw1 的方法，将<code>tempExpr</code>与<code>result</code>相乘。</p><blockquote><p>这种递归看起来很玄乎，让人难以琢磨，但实际上我们只需关注递归的<strong>功能</strong>和<strong>出口</strong>便可以轻松下手。<code>addTerm</code>的功能就是将项中的表达式因子展开，出口就是最内层的项不含表达式因子无需展开。这样，我们<strong>不关注实现的细节过程</strong>，而把这个还没写完的函数<strong>当作已经写好的具有特定功能的函数去用</strong>，复杂递归便可手到擒来。</p></blockquote><h3 id="指数函数">指数函数</h3><p>指数函数本身的实现比较简单，新建一个<code>Exp</code>类，使其具有<code>Expr</code>属性作为指数，同时实现<code>Factor</code>接口使其成为因子即可。<br><br>指数函数的难点在于<strong>合并同类项</strong>。在<code>Term</code>层面上，我们需要额外判定两个项是否具有指数函数（若有，是否相同）；在<code>Exp</code>层面上，我们需要判断其指数表达式是否相同，这就要求我们实现<code>Expr</code>层面判断是否相同（可以通过相减是否为零来判断），而这又将递归地去在<code>Term</code>层面判断同类项，直至项中不含<code>Exp</code>的出口。</p><blockquote><p>这里同样采取了递归下降的算法，但在实现了嵌套括号之后，<code>Exp</code>的问题实际上已经不算困难。</p></blockquote><h3 id="自定义函数">自定义函数</h3><p>自定义函数的难点在于<strong>函数代入</strong>。一个很自然的想法是<strong>字符串替换</strong>，即在<strong>预处理阶段</strong>直接用实参去替换函数表达式中的形参，得到代换后的表达式再做计算。鉴于我已经实现了<strong>多变量</strong>的功能，所以我很自然地抛弃了字符串替换的方法，选择了<strong>对象替换</strong>，即在<strong>表达式解析阶段</strong>把实参作为表达式因子对象去替换函数表达式中的变量因子对象。于是，很自然地，我出bug了…<br></p><h4 id="Bug-1">Bug 1</h4><h5 id="Bug-产生原因——函数代入错误">Bug 产生原因——函数代入错误</h5><p>举个例子:</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">f(y,x)=(1-y)*x</span><br><span class="line">f(x,1)</span><br></pre></td></tr></table></figure></div><p>在将<code>f(x,1)</code>中的第一个实参x代入时，由于x处在形参y的位置，故代入函数表达式得到<code>(1-x)*x</code>。而在代入第二个实参时，由于1处在形参x的位置，第二个形参x与第一个实参x名称相同，导致无法区分形参和实参，将1代入后遂得到了错误的表达式(1-1)*1。</p><p>其实我最初考虑过这样的问题，并通过对变量设置<code>isPara</code>属性来判断是否为形参，但在我整个代码的框架下，设置这样的属性并不能解决问题。</p><p>首先，在 Term 层面，我有一个<code>HashMap&lt;String,Monomial&gt;</code>属性，<strong>通过变量名称索引变量因子</strong>，这也就意味着<strong>项中无法同时存放两个名称相同的形参和实参</strong>。如果仅仅是这，那倒还不是问题，因为我可以把<strong>实参作为表达式因子存入项中</strong>，来避免无法存储同名形参和实参的问题。<br><br>但遗憾的时，由于我采用的是<strong>加入即化简</strong>的策略，一旦替换就会化简表达式，把实参合并入形参中，使得<code>isPara</code>这一属性在变量名称一致的情况下失效，导致错误。</p><h5 id="Bug-修复方案——区分变量名称">Bug 修复方案——区分变量名称</h5><p>由上述分析可以看到，<strong>项中无法同时存放两个名称相同的形参和实参</strong>，是一个死结。在不大改架构的前提下，修复bug的唯一方案就是<strong>区分形参和实参的变量名称</strong>。<br><br>(由于实参实际上只含有变量x，所以也可以采取<strong>先替换形参x</strong>再替换其他形参的策略来避免这个问题。但作为一个完美主义者，加之我的整个架构都是为了处理多变量而设计的，所以我没有采用这种<strong>投机</strong>的方法:dog::dog::dog:)<br><br>因此，我选择采用<strong>大小写替换</strong>的方式来区分形参实参。即在<strong>解析函数表达式</strong>的环节，将对应的形参换为大写的方式存储(实际上只要实参的变量名称和形参不一样都可以)</p><blockquote><p>这个bug表面上看起来只是一个疏忽，但反映出的却是<strong>功能耦合</strong>的问题。对象替换看似清晰直观，但却要在表达式解析阶段进行处理；字符串替换看似繁琐复杂，却能够实现<strong>函数代入和表达式解析的分离</strong>。对扩展开放，对修改封闭，因为你无法预料到原有架构会带来什么奇奇怪怪的问题。</p></blockquote><h2 id="Hw3——指数优化玩不起">Hw3——指数优化玩不起</h2><p>在 Hw2 的基础上，允许了函数表达式调用其他已定义的函数，新增了求导的功能。</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">input:</span><br><span class="line">3</span><br><span class="line">f(x)=exp(x)</span><br><span class="line">g(y,x)=exp(f(x))*exp(f(y))</span><br><span class="line">h(x,z)=(g(x,z))^2</span><br><span class="line">dx(h(x,x))</span><br><span class="line">output:</span><br><span class="line">4*exp((4*exp(x)+x))</span><br></pre></td></tr></table></figure></div><h3 id="函数调用">函数调用</h3><p>函数表达式调用其他已定义的函数实现起来比较简单。<br><br>在我的<strong>对象替换</strong>的实现中，获取函数表达式和解析表达式是一体的，所以几乎不需要更改什么，只要确保获得一个函数之后立刻放入函数集合中供表达式解析使用即可。<br><br>在<strong>字符串替换</strong>的实现中，也只需要对函数表达式进行<strong>函数代入</strong>的字符串替换过程即可。</p><h3 id="求导实现">求导实现</h3><p>求导本身只是增添了一种运算方式，并没有加入新的基础类型，所以只需要在表达式、项、因子三级按照求导公式新增求导的方法，上层递归调用下层，注意做好深拷贝即可。</p><h2 id="输出长度优化">输出长度优化</h2><p>在长度的优化上，幂函数的处理相对简单，注意<code>x</code>比<code>x^1</code>短即可。而<code>exp</code>输出形式的选择则相对复杂。</p><h3 id="exp-长度优化">exp 长度优化</h3><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exp((10+20*x))</span><br><span class="line">exp((1+2*x))^10</span><br><span class="line">exp((2+4*x))^5</span><br></pre></td></tr></table></figure></div><p>从上面这个例子可以看到，优化<code>exp</code>长度的出发点就是<strong>公因数的提取</strong>，使得较长的数字只以指数的形式出现一次，从而缩小长度。<br><br>但很显然的是，<strong>提取出公因数未必会变短</strong>（取决于<code>exp</code>内项的多少、公因数本身的长度和提取出公因数后每个项的缩短程度）。<br><br><strong>提取出最大公因数未必会比提取其他因子短</strong>（取决于公因数本身的长度和提取出公因数后每个项的缩短程度）。<br><br>同时，我们也要考虑<strong>形式化表述要求对字符串长度带来的影响</strong>，比如<code>exp((2*x))</code>写成<code>exp(x)^2</code>可免除内部括号和乘号。<br><br>因此我们需要对不同公因数下输出的长度作以比较再行决定输出的形式。</p><p>在这里，我选择了<strong>遍历最大公因数与最大公因数除以10之间的公因数</strong>，找到提取后长度最短的一种进行输出。这么做是因为上面提到的提取出最大公因数未必会比提取其他因子短的主要原因在于<strong>二者对每个项的缩短程度相同</strong>，而十倍则是必然使项缩短的一个界限。</p><h4 id="Bug-2">Bug 2</h4><h5 id="Bug-产生原因——指数提取出负数">Bug 产生原因——指数提取出负数</h5><p>尽管<code>BigInteger</code>类提供的<code>gcd</code>方法并不会出现公因数为负数的结果，但当<code>exp</code>内仅有一项时，我会直接返回这个项的系数。而如果这个项恰好为负的时，就会导致错误。比如，我会把<code>exp((-200*x))</code>优化为<code>exp(x)^-200</code>。</p><h5 id="Bug-修复方案——添加绝对值">Bug 修复方案——添加绝对值</h5><p>很简单，返回的公因数取其绝对值即可。</p><blockquote><p>优化不成还获得了C房体验卡，痛定思痛，痛何如哉！:disappointed::disappointed::disappointed:</p></blockquote><h3 id="仙人优化">仙人优化</h3><p>尽管上面对<code>exp</code>的处理似乎已经臻于完备，但在不少情况下，仍非最优解。</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><figcaption><span>{.line-numbers}</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exp((3*x+2*x^2+2*x^3+2*x^4+2*x^5))</span><br><span class="line">exp(x)*exp((x+x^2+x^3+x^4+x^5))^2</span><br></pre></td></tr></table></figure></div><p>在大多数情况下，因为个别项的存在，我们未必能提取出公因数。这个时候，我们就可以考虑个别项个别处理，<strong>以少数项长度的牺牲换取多数项长度的优化</strong>。这种处理需要极高的算法造诣，遍历大量的邻近公因数构成公因数集合再依次比较筛选，需要设置一定的阈值来避免超时的风险。笔者能力有限，在此不作赘述。</p><h2 id="程序分析">程序分析</h2><h3 id="复杂度分析">复杂度分析</h3><table><thead><tr><th style="text-align:center"><strong>class</strong></th><th style="text-align:center"><strong>OCvag</strong></th><th style="text-align:center"><strong>OCmax</strong></th><th style="text-align:center"><strong>WMC</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>src.expression.Exp</strong></td><td style="text-align:center">2.2</td><td style="text-align:center">6.0</td><td style="text-align:center">22.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Expr</strong></td><td style="text-align:center">2.7</td><td style="text-align:center">7.0</td><td style="text-align:center"><font color="red">47.0</font></td></tr><tr><td style="text-align:center"><strong>src.expression.Function</strong></td><td style="text-align:center">1.1</td><td style="text-align:center">2.0</td><td style="text-align:center">8.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Monomial</strong></td><td style="text-align:center">1.4</td><td style="text-align:center">2.0</td><td style="text-align:center">13.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Num</strong></td><td style="text-align:center">1.0</td><td style="text-align:center">1.0</td><td style="text-align:center">3.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Term</strong></td><td style="text-align:center"><font color="red">3.0</font></td><td style="text-align:center">10.0</td><td style="text-align:center"><font color="red">82.0</font></td></tr><tr><td style="text-align:center"><strong>src.expression.Token</strong></td><td style="text-align:center">1.2</td><td style="text-align:center">2.0</td><td style="text-align:center">5.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Token.Type</strong></td><td style="text-align:center">0.0</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>src.Lexer</strong></td><td style="text-align:center">3.0</td><td style="text-align:center">15.0</td><td style="text-align:center">24.0</td></tr><tr><td style="text-align:center"><strong>src.Main</strong></td><td style="text-align:center">2.0</td><td style="text-align:center">2.0</td><td style="text-align:center">2.0</td></tr><tr><td style="text-align:center"><strong>src.Parser</strong></td><td style="text-align:center"><font color="red">3.8</font></td><td style="text-align:center">12.0</td><td style="text-align:center"><font color="red">31.0</font></td></tr><tr><td style="text-align:center"><strong>Total</strong></td><td style="text-align:center">237.0</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>Average</strong></td><td style="text-align:center">2.51</td><td style="text-align:center">5.9</td><td style="text-align:center">21.5</td></tr></tbody></table><p>从图表中可以看到，<code>Expr</code>类、<code>Term</code>类和<code>Parser</code>类中负载了过多的方法，这与我上面提到的未能有效的把 <a href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AD%98%E5%82%A8">复杂度下放</a> 、 <a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0">表达式的解析与函数的代入耦合</a> 有关。</p><table><thead><tr><th style="text-align:center"><strong>method</strong></th><th style="text-align:center"><strong>CogC</strong></th><th style="text-align:center"><strong>ev(G)</strong></th><th style="text-align:center"><strong>iv(G)</strong></th><th style="text-align:center"><strong>v(G)</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>src.expression.Exp.toString()</strong></td><td style="text-align:center">8.0</td><td style="text-align:center"><font color="red">4.0</font></td><td style="text-align:center">3.0</td><td style="text-align:center">6.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Term.addFactor(Factor)</strong></td><td style="text-align:center"><font color="red">17.0</font></td><td style="text-align:center"><font color="red">7.0</font></td><td style="text-align:center">6.0</td><td style="text-align:center">10.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Term.isLike(Term)</strong></td><td style="text-align:center"><font color="red">16.0</font></td><td style="text-align:center"><font color="red">8.0</font></td><td style="text-align:center">6.0</td><td style="text-align:center"><font color="red">13.0</font></td></tr><tr><td style="text-align:center"><strong>src.expression.Term.toString()</strong></td><td style="text-align:center">8.0</td><td style="text-align:center"><font color="red">5.0</font></td><td style="text-align:center">7.0</td><td style="text-align:center">8.0</td></tr><tr><td style="text-align:center"><strong>src.Lexer.classify(String)</strong></td><td style="text-align:center">15.0</td><td style="text-align:center">1.0</td><td style="text-align:center"><font color="red">15.0</font></td><td style="text-align:center"><font color="red">15.0</font></td></tr><tr><td style="text-align:center"><strong>src.Parser.parseFactor()</strong></td><td style="text-align:center"><font color="red">18.0</font></td><td style="text-align:center"><font color="red">9.0</font></td><td style="text-align:center"><font color="red">15.0</font></td><td style="text-align:center"><font color="red">15.0</font></td></tr><tr><td style="text-align:center"><strong>…</strong></td><td style="text-align:center">…</td><td style="text-align:center">…</td><td style="text-align:center">…</td><td style="text-align:center">…</td></tr><tr><td style="text-align:center"><strong>Total</strong></td><td style="text-align:center">234.0</td><td style="text-align:center">145.0</td><td style="text-align:center">237.0</td><td style="text-align:center">265.0</td></tr><tr><td style="text-align:center">Average</td><td style="text-align:center">2.5</td><td style="text-align:center">1.5</td><td style="text-align:center">2.5</td><td style="text-align:center">2.8</td></tr></tbody></table><p>从图表中可以看到，<code>Exp</code>的优化、<code>Term</code>类对不同类型因子的处理输出、同类项的判断是复杂度超标的主要原因，需要做出<strong>更严整的类的设计</strong>以实现复杂度下放。而<code>Lexer</code>和<code>Parser</code>中过多的<code>if-else</code>语句也是程序设计不成熟的重要体现，需要做出更好的<strong>分类</strong>、<strong>抽象</strong>、<strong>包装</strong>工作。</p><h3 id="架构分析">架构分析</h3><p></p><figure class="image-caption"><img lazyload="" src="/images/loading.svg" data-src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/UML_Unit1-0-1.png" alt="alt text"><figcaption>alt text</figcaption></figure><p></p><p>总体来说，这次架构设计相对完善，两次迭代主要是在添加新的代码，并没有经过大面积的重构，整体思路也没有明显变化。但因为<s>懒惰</s>，没有进一步的包装、抽象、分离，导致个别类显得臃肿不堪。</p><table><thead><tr><th style="text-align:center"><strong>class</strong></th><th style="text-align:center"><strong>CLOC</strong></th><th style="text-align:center"><strong>JLOC</strong></th><th style="text-align:center"><strong>LOC</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>src.expression.Exp</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">88.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Expr</strong></td><td style="text-align:center">2.0</td><td style="text-align:center">0.0</td><td style="text-align:center">170.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Function</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">30.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Monomial</strong></td><td style="text-align:center">2.0</td><td style="text-align:center">0.0</td><td style="text-align:center">59.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Num</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">12.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Term</strong></td><td style="text-align:center">3.0</td><td style="text-align:center">0.0</td><td style="text-align:center">311.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Token</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">21.0</td></tr><tr><td style="text-align:center"><strong>src.expression.Token.Type</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">4.0</td></tr><tr><td style="text-align:center"><strong>src.Lexer</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">72.0</td></tr><tr><td style="text-align:center"><strong>src.Main</strong></td><td style="text-align:center">3.0</td><td style="text-align:center">0.0</td><td style="text-align:center">25.0</td></tr><tr><td style="text-align:center"><strong>src.Parser</strong></td><td style="text-align:center">0.0</td><td style="text-align:center">0.0</td><td style="text-align:center">145.0</td></tr><tr><td style="text-align:center"><strong>Total</strong></td><td style="text-align:center">10.0</td><td style="text-align:center">0.0</td><td style="text-align:center">937.0</td></tr><tr><td style="text-align:center"><strong>Average</strong></td><td style="text-align:center">0.91</td><td style="text-align:center">0.0</td><td style="text-align:center">85.18</td></tr></tbody></table><p>尽管有的地方写的比较抽象，但总体而言扩展性还是可以的，特别是三次作业中都实现了相应的多变量的功能，比如同类项合并、化简、求偏导等，而且<s>已经经过测试</s>，做好了多变量扩展的底层工作。按照本次作业<strong>数学计算工具</strong>的发展方向，我认为<strong>预留多变量的功能</strong>是相当必要的。</p><h2 id="Bug-检查">Bug 检查</h2><h3 id="评测机搭建">评测机搭建</h3><p>得益于<s>假期对python的学习</s>和AI的帮助，我在这次作业中成功搭建了自己的评测机。主要是通过<code>random</code>库来生成输入，通过<code>sympy</code>库来检验正确性。同时，我在python中用<strong>字符串替换</strong>的方式实现了函数代入的功能。因为<code>sympy</code>在处理<code>exp</code>时是通过代值计算的方式进行比较，导致其无法应对大量嵌套的情况。所以最后也是学习了同学的思路采取<strong>对减是否为零</strong>的方式来检验正确性。</p><p></p><figure class="image-caption"><img lazyload="" src="/images/loading.svg" data-src="https://foolish-han.oss-cn-beijing.aliyuncs.com/img/image-1.png" alt="alt text"><figcaption>alt text</figcaption></figure><p></p><p>但比较遗憾的是，由于我的评测机没有加入<strong>格式检查</strong>的功能，导致我指数为负的bug没有被检测出来；同时，由于检测的数据量较低，我函数重复代入的错误也没有被检测出来。这两个问题应该是我下一个单元搭建时应该考虑的重点。不过好在用自己的评测机发现了别人的bug，<s>刀人很爽</s>。</p><p>从我个人的经验来看，出现了 bug 的方法和未出现 bug 的方法在代码行和圈复杂度上并无明显差异，评测机的检验也只是一种碰运气似的<strong>辅助手段</strong>。要避免 bug 出现或者及时发现 bug ，更多的是需要架构上的考量，对项目的每个环节都有清晰的认知、规划、分工才能实现设计的完备性。</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">“要多想。”父亲说。</span><br><span class="line">“想了以后呢？”章北海问，他的双手紧紧攥着床单，手心和额头都潮湿了。</span><br><span class="line">“北海，我只能告诉你那以前要多想。”父亲回答。</span><br></pre></td></tr></table></figure></div><h2 id="心得体会">心得体会</h2><p>有一说一，尽管磕磕碰碰、bug不断，但还是挺喜欢这种独立设计一个体系结构的感觉（就像上学期的计组一样），毕竟<s>只有死去才能活来</s>。</p><p>为了进行高效的程序设计，我们就要有意识地重构，把代码按照共性特征抽象、封装起来，实现层次结构的清晰分明，对程序各部分的功能特征熟稔于心，进而才谈得上轻松有效的扩展。</p><blockquote><p>如果你不想大面积地重构话，那就多多进行小面积的重构吧！</p></blockquote><h2 id="未来方向">未来方向</h2><p>作为面向对象的开局之作，Unit1 不论是在难度上还是工作量上都比较合适，可以充分体会到编程的乐趣。其贯穿始终的递归下降思想，对于工程化的架构设计大有裨益。在此之外，我认为可以渗透一些 Java 的语法知识，让我们在充分认识 Java 工具的基础上去灵活应用（<s>要不直到 Unit1 我才知道内部类这个东西</s>）。</p></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D/">#递归下降</a>&nbsp;</li></ul><div class="recommended-article px-2 sm:px-6 md:px-8"><div class="recommended-desktop"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO 2024 Unit 4 & Final/" title="图书管理" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="图书管理" class="!max-w-none"> <span class="title">图书管理</span> </a><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO Unit 3/" title="社交网络" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="社交网络" class="!max-w-none"> <span class="title">社交网络</span> </a><a class="recommended-article-item" href="/2025/03/28/OS/Lab2实验报告/" title="OS-Lab2" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="OS-Lab2" class="!max-w-none"> <span class="title">OS-Lab2</span></a></div></div><div class="recommended-mobile"><div class="recommended-article-header text-xl md:text-3xl font-bold mt-10"><i aria-hidden="true"></i><span>推荐阅读</span></div><div class="recommended-article-group"><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO 2024 Unit 4 & Final/" title="图书管理" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="图书管理" class="!max-w-none"> <span class="title">图书管理</span> </a><a class="recommended-article-item" href="/2025/03/28/OO/BUAA OO Unit 3/" title="社交网络" rel="bookmark"><img src="/images/wallhaven-wqery6-light.webp" alt="社交网络" class="!max-w-none"> <span class="title">社交网络</span></a></div></div></div><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2025/03/28/OS/Lab1%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">OS-Lab1</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2025/03/28/OO/BUAA%20OO%202024%20Unit%204%20&amp;%20Final/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">图书管理</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">数学表达式计算</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Unit1-%E6%A6%82%E8%A7%88"><span class="nav-number">1.</span> <span class="nav-text">Unit1 概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw1-%E2%80%94%E2%80%94%E4%B8%87%E4%B8%88%E9%AB%98%E6%A5%BC%E5%B9%B3%E5%9C%B0%E8%B5%B7"><span class="nav-number">2.</span> <span class="nav-text">Hw1 ——万丈高楼平地起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">难点分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AD%98%E5%82%A8"><span class="nav-number">2.2.</span> <span class="nav-text">表达式存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%A7%A3%E6%9E%90"><span class="nav-number">2.3.</span> <span class="nav-text">表达式解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%96%E7%AE%80"><span class="nav-number">2.4.</span> <span class="nav-text">表达式化简</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BE%93%E5%87%BA"><span class="nav-number">2.5.</span> <span class="nav-text">表达式输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%A4%84%E7%90%86"><span class="nav-number">2.6.</span> <span class="nav-text">符号处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw2-%E2%80%94%E2%80%94%E5%87%BD%E6%95%B0%E4%BB%A3%E6%8D%A2%E4%BC%A4%E4%B8%8D%E8%B5%B7"><span class="nav-number">3.</span> <span class="nav-text">Hw2 ——函数代换伤不起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E6%8B%AC%E5%8F%B7"><span class="nav-number">3.1.</span> <span class="nav-text">嵌套括号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E6%95%B0%E5%87%BD%E6%95%B0"><span class="nav-number">3.2.</span> <span class="nav-text">指数函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">自定义函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Bug-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">Bug 1</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Bug-%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%E2%80%94%E2%80%94%E5%87%BD%E6%95%B0%E4%BB%A3%E5%85%A5%E9%94%99%E8%AF%AF"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">Bug 产生原因——函数代入错误</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bug-%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E5%8C%BA%E5%88%86%E5%8F%98%E9%87%8F%E5%90%8D%E7%A7%B0"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">Bug 修复方案——区分变量名称</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hw3%E2%80%94%E2%80%94%E6%8C%87%E6%95%B0%E4%BC%98%E5%8C%96%E7%8E%A9%E4%B8%8D%E8%B5%B7"><span class="nav-number">4.</span> <span class="nav-text">Hw3——指数优化玩不起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="nav-number">4.1.</span> <span class="nav-text">函数调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82%E5%AF%BC%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.2.</span> <span class="nav-text">求导实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E9%95%BF%E5%BA%A6%E4%BC%98%E5%8C%96"><span class="nav-number">5.</span> <span class="nav-text">输出长度优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-%E9%95%BF%E5%BA%A6%E4%BC%98%E5%8C%96"><span class="nav-number">5.1.</span> <span class="nav-text">exp 长度优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Bug-2"><span class="nav-number">5.1.1.</span> <span class="nav-text">Bug 2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Bug-%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%E2%80%94%E2%80%94%E6%8C%87%E6%95%B0%E6%8F%90%E5%8F%96%E5%87%BA%E8%B4%9F%E6%95%B0"><span class="nav-number">5.1.1.1.</span> <span class="nav-text">Bug 产生原因——指数提取出负数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bug-%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E6%B7%BB%E5%8A%A0%E7%BB%9D%E5%AF%B9%E5%80%BC"><span class="nav-number">5.1.1.2.</span> <span class="nav-text">Bug 修复方案——添加绝对值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%99%E4%BA%BA%E4%BC%98%E5%8C%96"><span class="nav-number">5.2.</span> <span class="nav-text">仙人优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="nav-number">6.</span> <span class="nav-text">程序分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90"><span class="nav-number">6.1.</span> <span class="nav-text">复杂度分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90"><span class="nav-number">6.2.</span> <span class="nav-text">架构分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bug-%E6%A3%80%E6%9F%A5"><span class="nav-number">7.</span> <span class="nav-text">Bug 检查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%84%E6%B5%8B%E6%9C%BA%E6%90%AD%E5%BB%BA"><span class="nav-number">7.1.</span> <span class="nav-text">评测机搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A"><span class="nav-number">8.</span> <span class="nav-text">心得体会</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AA%E6%9D%A5%E6%96%B9%E5%90%91"><span class="nav-number">9.</span> <span class="nav-text">未来方向</span></a></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="customize-info my-1">小舟从此逝，江海寄余生。</div><div class="text-center">&copy; <span>2025</span> - 2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Foolish-Han</a><p class="post-count space-x-0.5"><span>共撰写了 21 篇文章 </span><span>共 54.7k 字</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span></div><div class="icp-info my-1"><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">京ICP备2025112106号-1</a></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="站内搜索您需要的内容..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/build/libs/Swup.min.js"></script><script src="/js/build/libs/SwupSlideTheme.min.js"></script><script src="/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="/js/build/libs/SwupProgressPlugin.min.js"></script><script src="/js/build/libs/SwupScrollPlugin.min.js"></script><script src="/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/build/tools/imageViewer.js" type="module"></script><script src="/js/build/utils.js" type="module"></script><script src="/js/build/main.js" type="module"></script><script src="/js/build/layouts/navbarShrink.js" type="module"></script><script src="/js/build/tools/scrollTopBottom.js" type="module"></script><script src="/js/build/tools/lightDarkSwitch.js" type="module"></script><script src="/js/build/layouts/categoryList.js" type="module"></script><script src="/js/build/tools/localSearch.js" type="module"></script><script src="/js/build/tools/codeBlock.js" type="module"></script><script src="/js/build/layouts/lazyload.js" type="module"></script><script src="/js/build/tools/runtime.js"></script><script src="/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/build/libs/Typed.min.js"></script><script src="/js/build/plugins/typed.js" type="module"></script><script src="/js/build/libs/anime.min.js"></script><script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script><script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script><script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script><script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script><script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script><script src="/js/build/libs/pangu.min.js"></script><script src="/js/build/plugins/pangu.js"></script></body></html>